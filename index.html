<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HandiMap Kanto</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"M PLUS Rounded 1c"', 'sans-serif'] },
                    colors: { primary: '#0D9488', secondary: '#F0FDFA' },
                    animation: { 'bounce-slow': 'bounce 3s infinite' }
                }
            }
        }
    </script>
    <style>
        /* åŸºæœ¬è¨­å®šï¼šãƒã‚¦ãƒ³ã‚¹é˜²æ­¢ã¨é«˜ã•å›ºå®š */
        html, body { 
            height: 100%; 
            width: 100%; 
            overflow: hidden; 
            overscroll-behavior: none; /* iOSã§ã®ãƒã‚¦ãƒ³ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
            background-color: #F8FAFC; 
            -webkit-font-smoothing: antialiased; 
            color: #334155; 
            padding: 0;
            margin: 0;
        }

        /* ã‚¢ãƒ—ãƒªå…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #app-container { 
            display: flex; 
            flex-direction: column; 
            height: 100dvh; 
            width: 100vw; 
            position: relative;
        }

        @media (min-width: 768px) { #app-container { flex-direction: row; } }

        .page { display: none; flex: 1; height: 100%; width: 100%; flex-direction: column; position: relative; overflow: hidden; }
        .page.active { display: flex; }
        
        /* Map & Pins */
        #map { flex: 1; width: 100%; z-index: 0; background: #e5e7eb; }
        .pin-marker { background: white; border-radius: 50%; border: 2.5px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; font-size: 24px; width: 44px; height: 44px; position: relative; transition: all 0.3s; }
        .pin-marker::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid white; }
        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ”ãƒ³ã¯å°‘ã—å¤§ããã€æœ€å‰é¢ã« */
        .pin-marker.active-pin { background: #0D9488; color: white; border-color: #0D9488; transform: scale(1.3) translateY(-10px); z-index: 9999 !important; }
        .pin-marker.active-pin::after { border-top-color: #0D9488; }

        /* Filter */
        .filter-bar { 
            position: absolute; top: 0; left: 0; right: 0; z-index: 500; display: flex; justify-content: center; pointer-events: none; 
            padding-top: max(10px, env(safe-area-inset-top)); 
        }
        .chip-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 6px 16px; scrollbar-width: none; pointer-events: auto; max-width: 95%; background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); border-radius: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .chip { padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; white-space: nowrap; background: #F1F5F9; color: #94A3B8; transition: all 0.2s; }
        .chip.active { background: #0D9488; color: white; }

        /* Cards Scroller Area */
        .sheet-wrapper {
            position: absolute; 
            bottom: calc(60px + env(safe-area-inset-bottom)); 
            left: 0; right: 0; pointer-events: none; z-index: 400;
        }
        @media (min-width: 768px) { .sheet-wrapper { bottom: 20px; } }

        .card-scroller { 
            display: flex; gap: 12px; padding: 0 16px 10px; 
            overflow-x: auto; 
            scroll-snap-type: x mandatory; /* ã‚¹ãƒŠãƒƒãƒ—ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
            height: 170px; 
            pointer-events: auto; 
        }
        
        .map-card-horizontal { 
            flex: 0 0 85%; /* å°‘ã—å¹…ã‚’ç‹­ã‚ã¦æ¬¡ãŒè¦‹ãˆã‚‹ã‚ˆã†ã« */
            max-width: 340px; 
            scroll-snap-align: center; /* ä¸­å¤®ã«ã‚¹ãƒŠãƒƒãƒ— */
            background: white; border-radius: 20px; padding: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid transparent; 
            transition: all 0.3s; display: flex; flex-direction: column; 
            opacity: 0.8; transform: scale(0.95); /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã¯å°‘ã—å°ã•ã */
        }
        /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚«ãƒ¼ãƒ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .map-card-horizontal.active { 
            border-color: #0D9488; 
            opacity: 1; 
            transform: scale(1); 
            box-shadow: 0 15px 40px rgba(13, 148, 136, 0.2);
        }

        .map-card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 12px; border: 1px solid #F1F5F9; cursor: pointer; transition: background-color 0.2s; }
        .map-card:active { background-color: #F0FDFA; }

        /* UI Components */
        .gps-btn { 
            width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.15); color: #0D9488; font-size: 18px; position: absolute; right: 16px; 
            bottom: calc(240px + env(safe-area-inset-bottom)); z-index: 500; 
        }

        /* Nav */
        .nav-container { 
            z-index: 3000; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; 
            padding-bottom: env(safe-area-inset-bottom); height: calc(60px + env(safe-area-inset-bottom)); width: 100%; flex-shrink: 0; 
        }
        @media (min-width: 768px) { 
            .nav-container { position: static; width: 240px; height: 100%; flex-direction: column; justify-content: flex-start; padding-top: 40px; border-right: 1px solid #eee; border-top: none; padding-bottom: 0; } 
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94A3B8; font-size: 10px; font-weight: bold; cursor: pointer; height: 60px; }
        @media (min-width: 768px) { .nav-item { flex: 0; flex-direction: row; gap: 12px; padding: 16px; font-size: 14px; height: auto; } }
        .nav-item.active { color: #0D9488; }
        
        .modal-overlay { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,0.4); backdrop-filter: blur(2px); align-items: center; justify-content: center; }
        .modal-overlay.show { display: flex; }
        .modal-box { background: white; width: 85%; max-width: 320px; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        .list-header-padding { padding-top: max(16px, env(safe-area-inset-top)); }
    </style>
</head>
<body class="text-slate-700">

    <div id="app-container">
        <main class="flex-1 relative order-1 md:order-2 overflow-hidden bg-slate-50 w-full h-full">
            <div id="page-map" class="page active">
                <div class="filter-bar">
                    <div class="chip-scroll">
                        <button class="chip active" onclick="toggleMapFilter('leisure', this)">éŠåœ’åœ°</button>
                        <button class="chip active" onclick="toggleMapFilter('aquarium', this)">æ°´æ—é¤¨</button>
                        <button class="chip active" onclick="toggleMapFilter('zoo', this)">å‹•ç‰©åœ’</button>
                        <button class="chip active" onclick="toggleMapFilter('museum', this)">åšç‰©é¤¨</button>
                        <button class="chip active" onclick="toggleMapFilter('park', this)">å…¬åœ’</button>
                        <button class="chip active" onclick="toggleMapFilter('cinema', this)">æ˜ ç”»</button>
                    </div>
                </div>
                <button onclick="locateUserOnMap()" class="gps-btn"><i class="fas fa-crosshairs"></i></button>
                <div id="map"></div>
                <div class="sheet-wrapper">
                    <div id="card-scroller" class="card-scroller"></div>
                </div>
            </div>

            <div id="page-list" class="page overflow-y-auto">
                <div class="bg-white/90 backdrop-blur border-b border-slate-200 p-4 sticky top-0 z-10 list-header-padding">
                    <div class="relative w-full mb-3">
                        <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" class="w-full bg-slate-100 rounded-xl py-2.5 pl-10 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="æ¤œç´¢..." oninput="handleSearch(this.value)">
                    </div>
                    <div class="chip-scroll">
                        <button class="chip active" onclick="applyListFilter('all', this)">ã™ã¹ã¦</button>
                        <button class="chip" onclick="applyListFilter('leisure', this)">éŠåœ’åœ°</button>
                        <button class="chip" onclick="applyListFilter('aquarium', this)">æ°´æ—é¤¨</button>
                        <button class="chip" onclick="applyListFilter('zoo', this)">å‹•ç‰©åœ’</button>
                        <button class="chip" onclick="applyListFilter('museum', this)">åšç‰©é¤¨</button>
                    </div>
                </div>
                <div id="list-container" class="p-4 pb-24 md:pb-12 max-w-3xl mx-auto w-full"></div>
            </div>

            <div id="page-mylist" class="page overflow-y-auto">
                 <div class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-100 px-6 py-4 flex justify-between items-center list-header-padding">
                    <h1 class="text-lg font-bold"><i class="fas fa-bookmark text-pink-500 mr-2"></i>ä¿å­˜æ¸ˆã¿</h1>
                    <div class="flex bg-slate-100 rounded-lg p-1 gap-1">
                        <button onclick="switchListTab('fav')" id="tab-fav" class="px-3 py-1 text-xs font-bold rounded bg-white text-teal-600 shadow-sm">è¡ŒããŸã„</button>
                        <button onclick="switchListTab('visited')" id="tab-visited" class="px-3 py-1 text-xs font-bold rounded text-slate-400">è¡Œã£ãŸ</button>
                    </div>
                </div>
                <div id="mylist-container" class="p-4 pb-12 max-w-3xl mx-auto w-full"></div>
                
                <div class="p-6 border-t mt-auto text-center bg-white">
                    <h3 class="text-xs font-bold text-slate-400 mb-3">è¨­å®šãƒ»ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                    <div class="flex gap-3 justify-center mb-4">
                        <button onclick="openBackupModal('export')" class="px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg text-xs font-bold text-slate-600 shadow-sm"><i class="fas fa-copy mr-1"></i>ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
                        <button onclick="openBackupModal('import')" class="px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg text-xs font-bold text-slate-600 shadow-sm"><i class="fas fa-paste mr-1"></i>ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ</button>
                    </div>
                    
                    <div class="border-t border-slate-100 pt-4">
                        <div id="passcode-area" class="flex flex-col items-center gap-2">
                            <p class="text-[10px] text-slate-300">ç®¡ç†è€…ç”¨</p>
                            <div class="flex gap-2">
                                <input type="password" id="admin-passcode" placeholder="PASS" class="border border-slate-200 rounded px-2 py-1 text-xs w-20 text-center">
                                <button onclick="checkAdminPasscode()" class="bg-slate-300 text-white text-[10px] px-2 py-1 rounded font-bold">OK</button>
                            </div>
                        </div>
                        <div id="csv-admin-controls" class="hidden mt-2 animate-pulse bg-teal-50 border border-teal-200 rounded-xl p-3">
                            <p class="text-[10px] font-bold text-teal-700 mb-2">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰</p>
                            <div class="flex gap-2 justify-center">
                                <button onclick="downloadCSV()" class="px-3 py-2 bg-teal-600 text-white rounded text-xs font-bold flex-1">CSVä¿å­˜</button>
                                <label class="px-3 py-2 bg-white border border-teal-600 text-teal-600 rounded text-xs font-bold flex-1 cursor-pointer flex items-center justify-center">
                                    CSVèª­è¾¼
                                    <input type="file" id="csv-upload-input" accept=".csv" class="hidden" onchange="handleCSVUpload(this)">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <nav class="nav-container order-2 md:order-1">
            <div class="hidden md:block px-6 mb-8 text-teal-800 font-extrabold text-xl"><i class="fas fa-universal-access mr-2"></i>HandiMap</div>
            <div class="nav-item active" onclick="switchPage('map')" id="nav-map"><i class="fas fa-map-marked-alt text-xl md:text-base"></i><span>ãƒãƒƒãƒ—</span></div>
            <div class="nav-item" onclick="switchPage('list')" id="nav-list"><i class="fas fa-search text-xl md:text-base"></i><span>æ¢ã™</span></div>
            <div class="nav-item" onclick="switchPage('mylist')" id="nav-mylist"><i class="fas fa-heart text-xl md:text-base"></i><span>ä¿å­˜æ¸ˆã¿</span></div>
        </nav>
    </div>

    <div id="map-select-modal" class="modal-overlay">
        <div class="modal-box text-left">
            <h3 class="text-lg font-bold mb-4 text-center">çµŒè·¯æ¡ˆå†…</h3>
            <div class="flex flex-col gap-3 mb-4">
                <button onclick="confirmNavigation('google')" class="p-3 rounded-xl border hover:bg-teal-50 font-bold text-sm flex items-center"><i class="fab fa-google text-red-500 mr-3"></i>Googleãƒãƒƒãƒ—</button>
                <button onclick="confirmNavigation('default')" class="p-3 rounded-xl border hover:bg-teal-50 font-bold text-sm flex items-center"><i class="fas fa-map-marker-alt text-slate-500 mr-3"></i>æ¨™æº–ãƒãƒƒãƒ—</button>
            </div>
            <button onclick="closeModal('map-select-modal')" class="text-sm text-slate-400 w-full py-2">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div id="backup-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="backup-title" class="font-bold mb-2">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
            <p class="text-[10px] text-slate-400 mb-2">ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼/ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„</p>
            <textarea id="backup-text" class="w-full h-24 p-2 bg-slate-100 rounded text-xs mb-3 font-mono"></textarea>
            <div class="flex gap-2 justify-center">
                <button id="backup-action-btn" class="bg-teal-600 text-white px-4 py-2 rounded-lg text-xs font-bold">å®Ÿè¡Œ</button>
            </div>
            <button onclick="closeModal('backup-modal')" class="mt-3 text-xs text-slate-400">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const MASTER_CSV = `ID,æ–½è¨­å,éƒ½é“åºœçœŒ,ã‚¨ãƒªã‚¢,ã‚¸ãƒ£ãƒ³ãƒ«,æ–™é‡‘,ä½æ‰€,URL,ç·¯åº¦,çµŒåº¦
1001,æ—­å·å¸‚æ—­å±±å‹•ç‰©åœ’,åŒ—æµ·é“,æ—­å·å¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æ—­å·å¸‚æ±æ—­å·ç”ºå€‰æ²¼,,43.7684,142.48
1002,æœ­å¹Œå¸‚å††å±±å‹•ç‰©åœ’,åŒ—æµ·é“,æœ­å¹Œå¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå®®ãƒ¶ä¸˜3ç•ªåœ°1,,43.0526,141.3082
1003,åŒ—æµ·é“é–‹æ‹“ã®æ‘,åŒ—æµ·é“,æœ­å¹Œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚åšåˆ¥åŒºåšåˆ¥ç”ºå°é‡å¹Œ50-1,,43.0493,141.4983
1004,ä¸‰å†…ä¸¸å±±éºè·¡ã‚»ãƒ³ã‚¿ãƒ¼,é’æ£®çœŒ,é’æ£®å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,é’æ£®çœŒé’æ£®å¸‚ä¸‰å†…å­—ä¸¸å±±305,,40.8122,140.697
1005,ç››å²¡å¸‚å‹•ç‰©å…¬åœ’ ZOOMA,å²©æ‰‹çœŒ,ç››å²¡å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å²©æ‰‹çœŒç››å²¡å¸‚æ–°åº„å­—ä¸‹å…«æœ¨ç”°60-18,,39.7214,141.1923
1006,ä»™å°å¸‚åšç‰©é¤¨,å®®åŸçœŒ,ä»™å°å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å®®åŸçœŒä»™å°å¸‚é’è‘‰åŒºå·å†…26,,38.2562,140.8566
1007,ã‚¢ã‚¯ã‚¢ãƒãƒªãƒ³ãµãã—ã¾,ç¦å³¶çœŒ,ã„ã‚ãå¸‚,aquarium,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,ç¦å³¶çœŒã„ã‚ãå¸‚å°åæµœå­—è¾°å·³ç”º50,,36.9427,140.9032
1008,é¶´ãƒ¶åŸï¼ˆä¼šæ´¥è‹¥æ¾åŸï¼‰,ç¦å³¶çœŒ,ä¼šæ´¥è‹¥æ¾å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,ç¦å³¶çœŒä¼šæ´¥è‹¥æ¾å¸‚è¿½æ‰‹ç”º1-1,,37.4875,139.9297
1009,å›½å–¶ã²ãŸã¡æµ·æµœå…¬åœ’,èŒ¨åŸçœŒ,ã²ãŸã¡ãªã‹å¸‚,park,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,èŒ¨åŸçœŒã²ãŸã¡ãªã‹å¸‚é¦¬æ¸¡å­—å¤§æ²¼605-4,,36.4027,140.5927
1010,æ—¥å…‰ç”°æ¯æ²¢å¾¡ç”¨é‚¸è¨˜å¿µå…¬åœ’,æ ƒæœ¨çœŒ,æ—¥å…‰å¸‚,park,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ ƒæœ¨çœŒæ—¥å…‰å¸‚æœ¬ç”º8-27,,36.7533,139.5936
1011,å¯Œå²¡è£½ç³¸å ´,ç¾¤é¦¬çœŒ,å¯Œå²¡å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,ç¾¤é¦¬çœŒå¯Œå²¡å¸‚å¯Œå²¡1-1,,36.2553,138.8925
1012,ç¾¤é¦¬çœŒç«‹è‡ªç„¶å²åšç‰©é¤¨,ç¾¤é¦¬çœŒ,å¯Œå²¡å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,ç¾¤é¦¬çœŒå¯Œå²¡å¸‚ä¸Šé»’å²©1674-1,,36.2647,138.8833
1013,ã•ã„ãŸã¾æ°´æ—é¤¨,åŸ¼ç‰çœŒ,ç¾½ç”Ÿå¸‚,aquarium,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŸ¼ç‰çœŒç¾½ç”Ÿå¸‚ä¸‰ç”°ãƒ¶è°·751-1,,36.1736,139.5925
1014,åƒè‘‰å¸‚å‹•ç‰©å…¬åœ’,åƒè‘‰çœŒ,åƒè‘‰å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åƒè‘‰çœŒåƒè‘‰å¸‚è‹¥è‘‰åŒºæºç”º280,,35.6369,140.1222
1015,æ±äº¬å›½ç«‹åšç‰©é¤¨,æ±äº¬éƒ½,å°æ±åŒº,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™ï¼ˆç·åˆæ–‡åŒ–å±•ï¼‰,æ±äº¬éƒ½å°æ±åŒºä¸Šé‡å…¬åœ’13-9,,35.7187,139.7765
1016,å›½ç«‹ç§‘å­¦åšç‰©é¤¨,æ±äº¬éƒ½,å°æ±åŒº,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,æ±äº¬éƒ½å°æ±åŒºä¸Šé‡å…¬åœ’7-20,,35.7163,139.7766
1017,æ©è³œä¸Šé‡å‹•ç‰©åœ’,æ±äº¬éƒ½,å°æ±åŒº,zoo,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ±äº¬éƒ½å°æ±åŒºä¸Šé‡å…¬åœ’9-83,,35.7165,139.7713
1018,æ–°å®¿å¾¡è‹‘,æ±äº¬éƒ½,æ–°å®¿åŒº,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,æ±äº¬éƒ½æ–°å®¿åŒºå†…è—¤ç”º11,,35.6851,139.71
1019,è‘›è¥¿è‡¨æµ·æ°´æ—åœ’,æ±äº¬éƒ½,æ±Ÿæˆ¸å·åŒº,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ±äº¬éƒ½æ±Ÿæˆ¸å·åŒºè‡¨æµ·ç”º6-2-3,,35.6401,139.8624
1020,ã‚ˆã“ã¯ã¾å‹•ç‰©åœ’ã‚ºãƒ¼ãƒ©ã‚·ã‚¢,ç¥å¥ˆå·çœŒ,æ¨ªæµœå¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…2åã¾ã§ç„¡æ–™,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚æ—­åŒºä¸Šç™½æ ¹ç”º1175-1,,35.4944,139.5255
1021,å·å´å¸‚è—¤å­ãƒ»Fãƒ»ä¸äºŒé›„ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ ,ç¥å¥ˆå·çœŒ,å·å´å¸‚,leisure,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™ï¼ˆè¦äºˆç´„ï¼‰,ç¥å¥ˆå·çœŒå·å´å¸‚å¤šæ‘©åŒºé•·å°¾2-8-1,,35.6103,139.5732
1022,æ–°æ½Ÿå¸‚æ°´æ—é¤¨ ãƒãƒªãƒ³ãƒ”ã‚¢æ—¥æœ¬æµ·,æ–°æ½ŸçœŒ,æ–°æ½Ÿå¸‚,aquarium,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,æ–°æ½ŸçœŒæ–°æ½Ÿå¸‚ä¸­å¤®åŒºè¥¿èˆ¹è¦‹ç”º5932-445,,37.9239,139.0322
1023,å…¼å…­åœ’,çŸ³å·çœŒ,é‡‘æ²¢å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,çŸ³å·çœŒé‡‘æ²¢å¸‚å…¼å…­ç”º1,,36.562,136.6625
1024,ç¦äº•çœŒç«‹æç«œåšç‰©é¤¨,ç¦äº•çœŒ,å‹å±±å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™ï¼ˆå¸¸è¨­å±•ï¼‰,ç¦äº•çœŒå‹å±±å¸‚æ‘å²¡ç”ºå¯ºå°¾51-11,,36.0545,136.5033
1025,å±±æ¢¨çœŒç«‹ãƒªãƒ‹ã‚¢è¦‹å­¦ã‚»ãƒ³ã‚¿ãƒ¼,å±±æ¢¨çœŒ,éƒ½ç•™å¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,å±±æ¢¨çœŒéƒ½ç•™å¸‚å°å½¢å±±2381,,35.567,138.9372
1026,å›½å® æ¾æœ¬åŸ,é•·é‡çœŒ,æ¾æœ¬å¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,é•·é‡çœŒæ¾æœ¬å¸‚ä¸¸ã®å†…4-1,,36.2387,137.9691
1027,å²é˜œåŸ,å²é˜œçœŒ,å²é˜œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å²é˜œçœŒå²é˜œå¸‚é‡‘è¯å±±å¤©å®ˆé–£18,,35.4339,136.7821
1028,æµœæ¾å¸‚å‹•ç‰©åœ’,é™å²¡çœŒ,æµœæ¾å¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é™å²¡çœŒæµœæ¾å¸‚è¥¿åŒºèˆ˜å±±å¯ºç”º199,,34.7644,137.6622
1029,åå¤å±‹åŸ,æ„›çŸ¥çœŒ,åå¤å±‹å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…2åã¾ã§ç„¡æ–™,æ„›çŸ¥çœŒåå¤å±‹å¸‚ä¸­åŒºæœ¬ä¸¸1-1,,35.1847,136.9
1030,æ±å±±å‹•æ¤ç‰©åœ’,æ„›çŸ¥çœŒ,åå¤å±‹å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…2åã¾ã§ç„¡æ–™,æ„›çŸ¥çœŒåå¤å±‹å¸‚åƒç¨®åŒºæ±å±±å…ƒç”º3-70,,35.1565,136.9744
1031,ãƒˆãƒ¨ã‚¿ç”£æ¥­æŠ€è¡“è¨˜å¿µé¤¨,æ„›çŸ¥çœŒ,åå¤å±‹å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ„›çŸ¥çœŒåå¤å±‹å¸‚è¥¿åŒºå‰‡æ­¦æ–°ç”º4-1-35,,35.1828,136.8753
1032,å½¦æ ¹åŸ,æ»‹è³€çœŒ,å½¦æ ¹å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ»‹è³€çœŒå½¦æ ¹å¸‚é‡‘äº€ç”º1-1,,35.2766,136.2517
1033,å…ƒé›¢å®®äºŒæ¡åŸ,äº¬éƒ½åºœ,äº¬éƒ½å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,äº¬éƒ½åºœäº¬éƒ½å¸‚ä¸­äº¬åŒºäºŒæ¡é€šå €å·è¥¿å…¥äºŒæ¡åŸç”º541,,35.0142,135.7482
1034,äº¬éƒ½å›½ç«‹åšç‰©é¤¨,äº¬éƒ½åºœ,äº¬éƒ½å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™ï¼ˆåå“ã‚®ãƒ£ãƒ©ãƒªãƒ¼ï¼‰,äº¬éƒ½åºœäº¬éƒ½å¸‚æ±å±±åŒºèŒ¶å±‹ç”º527,,34.9906,135.7725
1035,äº¬éƒ½å¸‚å‹•ç‰©åœ’,äº¬éƒ½åºœ,äº¬éƒ½å¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,äº¬éƒ½åºœäº¬éƒ½å¸‚å·¦äº¬åŒºå²¡å´æ³•å‹å¯ºç”ºå²¡å´å…¬åœ’å†…,,35.0116,135.7836
1036,å¤§é˜ªåŸå¤©å®ˆé–£,å¤§é˜ªåºœ,å¤§é˜ªå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å¤§é˜ªåºœå¤§é˜ªå¸‚ä¸­å¤®åŒºå¤§é˜ªåŸ1-1,,34.6873,135.5262
1037,å¤©ç‹å¯ºå‹•ç‰©åœ’,å¤§é˜ªåºœ,å¤§é˜ªå¸‚,zoo,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,å¤§é˜ªåºœå¤§é˜ªå¸‚å¤©ç‹å¯ºåŒºèŒ¶è‡¼å±±ç”º1-108,,34.6506,135.5103
1038,ä¸‡åšè¨˜å¿µå…¬åœ’,å¤§é˜ªåºœ,å¹ç”°å¸‚,park,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,å¤§é˜ªåºœå¹ç”°å¸‚åƒé‡Œä¸‡åšå…¬åœ’,,34.8028,135.5367
1039,å§«è·¯åŸ,å…µåº«çœŒ,å§«è·¯å¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,å…µåº«çœŒå§«è·¯å¸‚æœ¬ç”º68,,34.8394,134.6939
1040,ç¥æˆ¸å¸‚ç«‹ç‹å­å‹•ç‰©åœ’,å…µåº«çœŒ,ç¥æˆ¸å¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å…µåº«çœŒç¥æˆ¸å¸‚ç˜åŒºç‹å­ç”º3-1,,34.7126,135.2166
1041,å¥ˆè‰¯å›½ç«‹åšç‰©é¤¨,å¥ˆè‰¯çœŒ,å¥ˆè‰¯å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å¥ˆè‰¯çœŒå¥ˆè‰¯å¸‚ç™»å¤§è·¯ç”º50,,34.6836,135.8358
1042,å’Œæ­Œå±±åŸ,å’Œæ­Œå±±çœŒ,å’Œæ­Œå±±å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,å’Œæ­Œå±±çœŒå’Œæ­Œå±±å¸‚ä¸€ç•ªä¸3,,34.2255,135.1706
1043,é³¥å–ç ‚ä¸˜ ç ‚ã®ç¾è¡“é¤¨,é³¥å–çœŒ,é³¥å–å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é³¥å–çœŒé³¥å–å¸‚ç¦éƒ¨ç”ºæ¹¯å±±2083-17,,35.5404,134.2382
1044,æ¾æ±ŸåŸ,å³¶æ ¹çœŒ,æ¾æ±Ÿå¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,å³¶æ ¹çœŒæ¾æ±Ÿå¸‚æ®¿ç”º1-5,,35.4753,133.0505
1045,å²¡å±±å¾Œæ¥½åœ’,å²¡å±±çœŒ,å²¡å±±å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å²¡å±±çœŒå²¡å±±å¸‚åŒ—åŒºå¾Œæ¥½åœ’1-5,,34.6669,133.9358
1046,åºƒå³¶å¹³å’Œè¨˜å¿µè³‡æ–™é¤¨,åºƒå³¶çœŒ,åºƒå³¶å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åºƒå³¶çœŒåºƒå³¶å¸‚ä¸­åŒºä¸­å³¶ç”º1-2,,34.3916,132.4519
1047,æµ·éŸ¿é¤¨ï¼ˆå¸‚ç«‹ã—ã‚‚ã®ã›ãæ°´æ—é¤¨ï¼‰,å±±å£çœŒ,ä¸‹é–¢å¸‚,aquarium,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å±±å£çœŒä¸‹é–¢å¸‚ã‚ã‚‹ã‹ã½ãƒ¼ã¨6-1,,33.9538,130.9436
1048,æ —æ—å…¬åœ’,é¦™å·çœŒ,é«˜æ¾å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é¦™å·çœŒé«˜æ¾å¸‚æ —æ—ç”º1-20-16,,34.3323,134.0439
1049,æ¾å±±åŸ,æ„›åª›çœŒ,æ¾å±±å¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…2åã¾ã§ç„¡æ–™,æ„›åª›çœŒæ¾å±±å¸‚ä¸¸ä¹‹å†…1,,33.8455,132.7663
1050,æ„›åª›çœŒç«‹ã¨ã¹å‹•ç‰©åœ’,æ„›åª›çœŒ,ç ¥éƒ¨ç”º,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,æ„›åª›çœŒä¼Šäºˆéƒ¡ç ¥éƒ¨ç”ºä¸ŠåŸç”º240,,33.7667,132.7961
1051,é«˜çŸ¥åŸ,é«˜çŸ¥çœŒ,é«˜çŸ¥å¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é«˜çŸ¥çœŒé«˜çŸ¥å¸‚ä¸¸ãƒå†…1-2-1,,33.5607,133.5312
1052,ä¹å·å›½ç«‹åšç‰©é¤¨,ç¦å²¡çœŒ,å¤ªå®°åºœå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™ï¼ˆæ–‡åŒ–äº¤æµå±•ï¼‰,ç¦å²¡çœŒå¤ªå®°åºœå¸‚çŸ³å‚4-7-2,,33.5186,130.5242
1053,æµ·ã®ä¸­é“æµ·æµœå…¬åœ’,ç¦å²¡çœŒ,ç¦å²¡å¸‚,park,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,ç¦å²¡çœŒç¦å²¡å¸‚æ±åŒºå¤§å­—è¥¿æˆ¸å´18-25,,33.6558,130.3664
1054,ã‚°ãƒ©ãƒãƒ¼åœ’,é•·å´çœŒ,é•·å´å¸‚,park,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é•·å´çœŒé•·å´å¸‚å—å±±æ‰‹ç”º8-1,,32.7341,129.8696
1055,ç†Šæœ¬åŸ,ç†Šæœ¬çœŒ,ç†Šæœ¬å¸‚,museum,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,ç†Šæœ¬çœŒç†Šæœ¬å¸‚ä¸­å¤®åŒºæœ¬ä¸¸1-1,,32.8062,130.7058
1056,ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹è‡ªç„¶å‹•ç‰©åœ’,å®®å´çœŒ,å®®å´å¸‚,zoo,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,å®®å´çœŒå®®å´å¸‚å¡©è·¯æµœå±±3083-42,,31.9567,131.4722
1057,ã„ãŠãƒ¯ãƒ¼ãƒ«ãƒ‰ã‹ã”ã—ã¾æ°´æ—é¤¨,é¹¿å…å³¶çœŒ,é¹¿å…å³¶å¸‚,aquarium,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,é¹¿å…å³¶çœŒé¹¿å…å³¶å¸‚æœ¬æ¸¯æ–°ç”º3-1,,31.5947,130.5636
1058,æ²–ç¸„ç¾ã‚‰æµ·æ°´æ—é¤¨,æ²–ç¸„çœŒ,æœ¬éƒ¨ç”º,aquarium,æœ¬äººã¨ä»˜æ·»äºº1åç„¡æ–™,æ²–ç¸„çœŒå›½é ­éƒ¡æœ¬éƒ¨ç”ºçŸ³å·424,,26.6943,127.8779
1059,é¦–é‡ŒåŸå…¬åœ’,æ²–ç¸„çœŒ,é‚£è¦‡å¸‚,museum,æœ¬äººã¨ä»‹åŠ©è€…1åç„¡æ–™,æ²–ç¸„çœŒé‚£è¦‡å¸‚é¦–é‡Œé‡‘åŸç”º1-2,,26.217,127.7196
1060,åŒ—æµ·é“åšç‰©é¤¨,åŒ—æµ·é“,æœ­å¹Œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚åšåˆ¥åŒºåšåˆ¥ç”ºå°é‡å¹Œ53-2,https://www.hm.pref.hokkaido.lg.jp/,43.0531,141.4965
1061,åŒ—æµ·é“ç«‹è¿‘ä»£ç¾è¡“é¤¨,åŒ—æµ·é“,æœ­å¹Œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºåŒ—1æ¡è¥¿17ä¸ç›®,https://artmuseum.pref.hokkaido.lg.jp/knb,43.0602,141.3303
1062,æœ¬éƒ·æ–°è¨˜å¿µæœ­å¹Œå½«åˆ»ç¾è¡“é¤¨,åŒ—æµ·é“,æœ­å¹Œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå®®ã®æ£®4æ¡12ä¸ç›®,http://www.hongoshin-smos.jp/,43.0548,141.2928
1063,æœ­å¹ŒèŠ¸è¡“ã®æ£®,åŒ—æµ·é“,æœ­å¹Œå¸‚,museum,æœ¬äººã¨ä»‹è­·è€…1åç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚å—åŒºèŠ¸è¡“ã®æ£®2ä¸ç›®75,https://artpark.or.jp/,42.9421,141.3422
1064,ã•ã£ã½ã‚ç¾Šã‚±ä¸˜å±•æœ›å°,åŒ—æµ·é“,æœ­å¹Œå¸‚,park,æœ¬äººã®ã¿ç„¡æ–™,åŒ—æµ·é“æœ­å¹Œå¸‚è±Šå¹³åŒºç¾Šãƒ¶ä¸˜1ç•ªåœ°,https://www.hitsujigaoka.jp/,42.9991,141.3944
1065,AOAO SAPPORO,åŒ—æµ·é“,æœ­å¹Œå¸‚,aquarium,æœ¬äººã¨ä»‹è­·è€…1ååŠé¡,åŒ—æµ·é“æœ­å¹Œå¸‚ä¸­å¤®åŒºå—2æ¡è¥¿3ä¸ç›®20 moyuk SAPPORO 4F-6F,https://aoao-sapporo.blue/,43.0577,141.3533
1066,æ±äº¬ãƒ‡ã‚£ã‚ºãƒ‹ãƒ¼ãƒªã‚¾ãƒ¼ãƒˆ,åƒè‘‰çœŒ,æµ¦å®‰å¸‚,leisure,éšœãŒã„ã®ã‚ã‚‹æ–¹å‘ã‘ãƒã‚±ãƒƒãƒˆã‚ã‚Šï¼ˆå¤‰å‹•ä¾¡æ ¼ï¼‰,åƒè‘‰çœŒæµ¦å®‰å¸‚èˆæµœ1-1,,35.6329,139.8804
1067,ãƒã‚¶ãƒ¼ç‰§å ´,åƒè‘‰çœŒ,å¯Œæ´¥å¸‚,park,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ä¸€èˆ¬æ–™é‡‘ã®åŠé¡,åƒè‘‰çœŒå¯Œæ´¥å¸‚ç”°å€‰940-3,,35.246,139.9348
1068,é´¨å·ã‚·ãƒ¼ãƒ¯ãƒ¼ãƒ«ãƒ‰,åƒè‘‰çœŒ,é´¨å·å¸‚,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ä¸€èˆ¬æ–™é‡‘ã®åŠé¡,åƒè‘‰çœŒé´¨å·å¸‚æ±ç”º1464-18,,35.1164,140.1202
1069,å¸‚åŸãã†ã®å›½,åƒè‘‰çœŒ,å¸‚åŸå¸‚,zoo,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,åƒè‘‰çœŒå¸‚åŸå¸‚å±±å°å·937,,35.3547,140.1823
1070,æ±äº¬ãƒ‰ã‚¤ãƒ„æ‘,åƒè‘‰çœŒ,è¢–ã‚±æµ¦å¸‚,park,é§è»Šæ–™é‡‘ç­‰ã®å‰²å¼•ï¼ˆè¦ç¢ºèªï¼‰,åƒè‘‰çœŒè¢–ã‚±æµ¦å¸‚æ°¸å‰419,,35.4055,140.0594
1071,æˆç”°ã‚†ã‚ç‰§å ´,åƒè‘‰çœŒ,æˆç”°å¸‚,park,å…¥å ´æ–™å‰²å¼•ï¼ˆç´„åŠé¡ï¼‰,åƒè‘‰çœŒæˆç”°å¸‚åæœ¨730-3,,35.8693,140.3954
1072,ãµãªã°ã—ã‚¢ãƒ³ãƒ‡ãƒ«ã‚»ãƒ³å…¬åœ’,åƒè‘‰çœŒ,èˆ¹æ©‹å¸‚,park,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥åœ’ç„¡æ–™,åƒè‘‰çœŒèˆ¹æ©‹å¸‚é‡‘å €ç”º525,,35.7599,140.0629
1073,åƒè‘‰ãƒãƒ¼ãƒˆã‚¿ãƒ¯ãƒ¼,åƒè‘‰çœŒ,åƒè‘‰å¸‚,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥é¤¨ç„¡æ–™,åƒè‘‰çœŒåƒè‘‰å¸‚ä¸­å¤®åŒºä¸­å¤®æ¸¯1,,35.6004,140.0978
1074,é‹¸å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ãƒ¼,åƒè‘‰çœŒ,å¯Œæ´¥å¸‚,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å¾€å¾©é‹è³ƒç´„åŠé¡,åƒè‘‰çœŒå¯Œæ´¥å¸‚é‡‘è°·4052-1,,35.1623,139.823
1075,äº¬æˆãƒãƒ©åœ’,åƒè‘‰çœŒ,å…«åƒä»£å¸‚,park,å…¥åœ’æ–™å‰²å¼•,åƒè‘‰çœŒå…«åƒä»£å¸‚å¤§å’Œç”°æ–°ç”°755,,35.731,140.0875
1076,æ¨ªæµœãƒ»å…«æ™¯å³¶ã‚·ãƒ¼ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹,ç¥å¥ˆå·çœŒ,æ¨ªæµœå¸‚,aquarium,ãƒ¯ãƒ³ãƒ‡ãƒ¼ãƒ‘ã‚¹ç­‰ãŒ5å‰²å¼•ã,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚é‡‘æ²¢åŒºå…«æ™¯å³¶,,35.3367,139.6468
1077,æ–°æ±Ÿãƒå³¶æ°´æ—é¤¨,ç¥å¥ˆå·çœŒ,è—¤æ²¢å¸‚,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ä¸€èˆ¬æ–™é‡‘ã®åŠé¡,ç¥å¥ˆå·çœŒè—¤æ²¢å¸‚ç‰‡ç€¬æµ·å²¸2-19-1,,35.3097,139.4797
1078,æ¨ªæµœãƒ©ãƒ³ãƒ‰ãƒãƒ¼ã‚¯ã‚¿ãƒ¯ãƒ¼ ã‚¹ã‚«ã‚¤ã‚¬ãƒ¼ãƒ‡ãƒ³,ç¥å¥ˆå·çœŒ,æ¨ªæµœå¸‚,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥å ´æ–™åŠé¡,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚è¥¿åŒºã¿ãªã¨ã¿ã‚‰ã„2-2-1,,35.4543,139.631
1079,ã‚«ãƒƒãƒ—ãƒŒãƒ¼ãƒ‰ãƒ«ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ  æ¨ªæµœ,ç¥å¥ˆå·çœŒ,æ¨ªæµœå¸‚,museum,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥é¤¨ç„¡æ–™ï¼ˆä½“é¨“æ–™åˆ¥é€”ï¼‰,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚ä¸­åŒºæ–°æ¸¯2-3-4,,35.4554,139.6395
1080,ç®±æ ¹åœ’æ°´æ—é¤¨,ç¥å¥ˆå·çœŒ,ç®±æ ¹ç”º,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å‰²å¼•ï¼ˆç´„åŠé¡ï¼‰,ç¥å¥ˆå·çœŒè¶³æŸ„ä¸‹éƒ¡ç®±æ ¹ç”ºå…ƒç®±æ ¹139,,35.2122,139.0093
1081,å½«åˆ»ã®æ£®ç¾è¡“é¤¨,ç¥å¥ˆå·çœŒ,ç®±æ ¹ç”º,museum,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å‰²å¼•,ç¥å¥ˆå·çœŒè¶³æŸ„ä¸‹éƒ¡ç®±æ ¹ç”ºäºŒãƒå¹³1121,,35.2447,139.0513
1082,ç®±æ ¹ã‚¬ãƒ©ã‚¹ã®æ£®ç¾è¡“é¤¨,ç¥å¥ˆå·çœŒ,ç®±æ ¹ç”º,museum,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å‰²å¼•,ç¥å¥ˆå·çœŒè¶³æŸ„ä¸‹éƒ¡ç®±æ ¹ç”ºä»™çŸ³åŸ940-48,,35.2663,139.0177
1083,ã‚ˆã¿ã†ã‚Šãƒ©ãƒ³ãƒ‰,æ±äº¬éƒ½,ç¨²åŸå¸‚,leisure,ãƒ¯ãƒ³ãƒ‡ãƒ¼ãƒ‘ã‚¹ç­‰å‰²å¼•,æ±äº¬éƒ½ç¨²åŸå¸‚çŸ¢é‡å£4015-1,,35.623,139.5187
1084,ç®±æ ¹ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤,ç¥å¥ˆå·çœŒ,ç®±æ ¹ç”º,leisure,é‹è³ƒå‰²å¼•,ç¥å¥ˆå·çœŒè¶³æŸ„ä¸‹éƒ¡ç®±æ ¹ç”ºå¼·ç¾…1300,,35.2464,139.0356
1085,ç®±æ ¹æµ·è³Šèˆ¹,ç¥å¥ˆå·çœŒ,ç®±æ ¹ç”º,leisure,é‹è³ƒå‰²å¼•,ç¥å¥ˆå·çœŒè¶³æŸ„ä¸‹éƒ¡ç®±æ ¹ç”ºå…ƒç®±æ ¹,,35.2009,139.0305
1086,ãƒãƒªãƒ¼ãƒ³ãƒ«ãƒ¼ã‚¸ãƒ¥,ç¥å¥ˆå·çœŒ,æ¨ªæµœå¸‚,leisure,ä¹—èˆ¹æ–™å‰²å¼•,ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚ä¸­åŒºå±±ä¸‹ç”º,,35.4456,139.6515
1087,TOHOã‚·ãƒãƒã‚º,æ±äº¬éƒ½,åƒä»£ç”°åŒº,cinema,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§é‘‘è³æ–™é‡‘1000å††,æ±äº¬éƒ½åƒä»£ç”°åŒºæœ‰æ¥½ç”º1-1-2,,35.6736,139.7592
1088,ã‚¤ã‚ªãƒ³ã‚·ãƒãƒ,åƒè‘‰çœŒ,åƒè‘‰å¸‚,cinema,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§é‘‘è³æ–™é‡‘1000å††,åƒè‘‰çœŒåƒè‘‰å¸‚ç¾æµœåŒºè±Šç ‚1-1,,35.6512,140.0383
1089,109ã‚·ãƒãƒã‚º,æ±äº¬éƒ½,ä¸–ç”°è°·åŒº,cinema,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§é‘‘è³æ–™é‡‘1000å††,æ±äº¬éƒ½ä¸–ç”°è°·åŒºç‰å·1-14-1,,35.611,139.6297
1090,ãƒ“ãƒƒã‚°ã‚¨ã‚³ãƒ¼,æ±äº¬éƒ½,ä¸­å¤®åŒº,leisure,å®¤æ–™å‰²å¼•ï¼ˆåº—èˆ—ã«ã‚ˆã‚Šç•°ãªã‚‹ï¼‰,æ±äº¬éƒ½ä¸­å¤®åŒºéŠ€åº§4-2-14,,35.6725,139.7635
1091,ãƒ©ã‚¦ãƒ³ãƒ‰ãƒ¯ãƒ³,æ±äº¬éƒ½,æ±Ÿæ±åŒº,leisure,ã‚¯ãƒ©ãƒ–ä¼šå“¡å…¥ä¼šè²»å…é™¤ãƒ»è²¸é´ç„¡æ–™ãªã©åº—èˆ—ã«ã‚ˆã‚‹,æ±äº¬éƒ½æ±Ÿæ±åŒºé’æµ·1-1-10,,35.6256,139.7745
1092,æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼,æ±äº¬éƒ½,å¢¨ç”°åŒº,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å½“æ—¥åˆ¸ãŒç´„åŠé¡,æ±äº¬éƒ½å¢¨ç”°åŒºæŠ¼ä¸Š1-1-2,,35.71,139.8107
1093,æ±äº¬ã‚¿ãƒ¯ãƒ¼,æ±äº¬éƒ½,æ¸¯åŒº,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,æ±äº¬éƒ½æ¸¯åŒºèŠå…¬åœ’4-2-8,,35.6586,139.7454
1094,ã‚µãƒ³ãƒªã‚ªãƒ”ãƒ¥ãƒ¼ãƒ­ãƒ©ãƒ³ãƒ‰,æ±äº¬éƒ½,å¤šæ‘©å¸‚,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ãƒã‚±ãƒƒãƒˆ200å††å¼•ï¼ˆçª“å£è³¼å…¥ï¼‰,æ±äº¬éƒ½å¤šæ‘©å¸‚è½åˆ1-31,,35.6246,139.4291
1095,ã‚µãƒ³ã‚·ãƒ£ã‚¤ãƒ³æ°´æ—é¤¨,æ±äº¬éƒ½,è±Šå³¶åŒº,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,æ±äº¬éƒ½è±Šå³¶åŒºæ±æ± è¢‹3-1,,35.7291,139.7198
1096,ãƒã‚¯ã‚»ãƒ« ã‚¢ã‚¯ã‚¢ãƒ‘ãƒ¼ã‚¯å“å·,æ±äº¬éƒ½,æ¸¯åŒº,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,æ±äº¬éƒ½æ¸¯åŒºé«˜è¼ª4-10-30,,35.6278,139.7352
1097,ã™ã¿ã æ°´æ—é¤¨,æ±äº¬éƒ½,å¢¨ç”°åŒº,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,æ±äº¬éƒ½å¢¨ç”°åŒºæŠ¼ä¸Š1-1-2,,35.71,139.8107
1098,ã—ãªãŒã‚æ°´æ—é¤¨,æ±äº¬éƒ½,å“å·åŒº,aquarium,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§2å‰²ã€œ5å‰²å¼•ï¼ˆåŒºå¤–ãƒ»åŒºæ°‘ã§å¤‰å‹•ï¼‰,æ±äº¬éƒ½å“å·åŒºå‹å³¶3-2-1,,35.5884,139.7375
1099,æ±äº¬ã‚¸ãƒ§ã‚¤ãƒãƒªã‚¹,æ±äº¬éƒ½,æ¸¯åŒº,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥å ´ç„¡æ–™ï¼ˆãƒ‘ã‚¹ãƒãƒ¼ãƒˆã¯å‰²å¼•è²©å£²ï¼‰,æ±äº¬éƒ½æ¸¯åŒºå°å ´1-6-1,,35.6288,139.7766
1100,å…­æœ¬æœ¨ãƒ’ãƒ«ã‚ºå±•æœ›å° æ±äº¬ã‚·ãƒ†ã‚£ãƒ“ãƒ¥ãƒ¼,æ±äº¬éƒ½,æ¸¯åŒº,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§ç´„åŠé¡,æ±äº¬éƒ½æ¸¯åŒºå…­æœ¬æœ¨6-10-1,,35.6604,139.7292
1101,æµ…è‰èŠ±ã‚„ã—ã,æ±äº¬éƒ½,å°æ±åŒº,leisure,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å…¥åœ’ç„¡æ–™ï¼ˆã®ã‚Šã‚‚ã®åˆ¸åˆ¥é€”ï¼‰,æ±äº¬éƒ½å°æ±åŒºæµ…è‰2-28-1,,35.7154,139.7946
1102,ãƒãƒ¼ãƒ ãƒ©ãƒœãƒ—ãƒ©ãƒãƒƒãƒ„ TOKYO DMM,æ±äº¬éƒ½,æ±Ÿæ±åŒº,museum,éšœãŒã„è€…å‰²å¼•ãƒã‚±ãƒƒãƒˆã‚ã‚Šï¼ˆç´„åŠé¡ã€œï¼‰,æ±äº¬éƒ½æ±Ÿæ±åŒºè±Šæ´²6-1-16,,35.6469,139.7942
1103,ãƒ¬ã‚´ãƒ©ãƒ³ãƒ‰ãƒ»ãƒ‡ã‚£ã‚¹ã‚«ãƒãƒªãƒ¼ãƒ»ã‚»ãƒ³ã‚¿ãƒ¼æ±äº¬,æ±äº¬éƒ½,æ¸¯åŒº,park,éšœãŒã„è€…å‰²å¼•ãƒã‚±ãƒƒãƒˆã‚ã‚Š,æ±äº¬éƒ½æ¸¯åŒºå°å ´1-6-1,,35.6289,139.7763
1104,ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒ¯ãƒ¼ãƒ«ã‚º,æ±äº¬éƒ½,æ±Ÿæ±åŒº,museum,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å‰²å¼•,æ±äº¬éƒ½æ±Ÿæ±åŒºæœ‰æ˜1-3-33,,35.6378,139.7883
1105,ã‚¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚¢ãƒªã‚¦ãƒ ç¾è¡“é¤¨ GINZA,æ±äº¬éƒ½,ä¸­å¤®åŒº,museum,æœ¬äººãƒ»ä»‹åŠ©è€…1åã¾ã§å‰²å¼•,æ±äº¬éƒ½ä¸­å¤®åŒºéŠ€åº§4-6-16,,35.6713,139.7661`;

        let map, markers = {};
        let userStatus = JSON.parse(localStorage.getItem('handimap_v2')) || {};
        let userCurrentPos = null;
        let activeListCategory = 'all';
        let activeMapCategories = new Set(['leisure', 'aquarium', 'zoo', 'museum', 'park', 'cinema']);
        let searchQuery = "";
        let currentListTab = 'fav';
        let facilitiesData = [];
        
        // ãƒ•ãƒ©ã‚°: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­ã‹ï¼Ÿ
        let isProgrammaticScroll = false;
        let scrollTimeout;
        let isMapFlying = false;

        // Intersection Observer for Scroll Sync
        let observer;

        window.onload = function() {
            facilitiesData = parseCSV(MASTER_CSV);
            initMap();
            renderList();
            renderMyList();
        };

        function parseCSV(csv) {
            return csv.trim().split('\n').slice(1).map(line => {
                const [id,name,pref,area,cat,price,addr,url,lat,lng] = line.split(',');
                if(!name) return null;
                return { 
                    id: parseInt(id), name, pref, area, category: cat, price, address: addr, url, 
                    lat: lat ? parseFloat(lat) : null, lng: lng ? parseFloat(lng) : null 
                };
            }).filter(Boolean);
        }

        function getIcon(cat) { return { leisure:'ğŸ¡', zoo:'ğŸ˜', aquarium:'ğŸ¬', cinema:'ğŸ¬', museum:'ğŸ›ï¸', park:'ğŸŒ³' }[cat] || 'ğŸ“'; }
        
        function getDistance(lat1, lng1, lat2, lng2) {
            const R = 6371, dLat = (lat2-lat1)*Math.PI/180, dLon = (lng2-lng1)*Math.PI/180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        function initMap() {
            if(map) return;
            map = L.map('map', { zoomControl: false }).setView([35.6895, 139.6917], 10);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
            if(window.innerWidth >= 768) L.control.zoom({ position: 'bottomright' }).addTo(map);
            
            // ãƒãƒƒãƒ—ç§»å‹•çµ‚äº†æ™‚ã«ãƒªã‚¹ãƒˆã‚’å†ç”Ÿæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§ãƒãƒƒãƒ—ã‚’å‹•ã‹ã—ãŸæ™‚ã®ã¿ï¼‰
            map.on('moveend', () => {
                if(!isMapFlying) {
                    updateVisibleSpots(); 
                }
                isMapFlying = false;
            });
            renderAllMarkers();
        }

        function renderAllMarkers() {
            Object.values(markers).forEach(m => map.removeLayer(m));
            markers = {};
            facilitiesData.forEach(spot => {
                if (!spot.lat || !activeMapCategories.has(spot.category)) return;
                const icon = L.divIcon({ className: 'custom-div-icon', html: `<div id="pin-${spot.id}" class="pin-marker">${getIcon(spot.category)}</div>`, iconSize: [44, 44], iconAnchor: [22, 50] });
                const marker = L.marker([spot.lat, spot.lng], { icon: icon }).addTo(map);
                marker.on('click', (e) => { 
                    L.DomEvent.stopPropagation(e); 
                    // ã‚¯ãƒªãƒƒã‚¯æ™‚ã¯ä¸­å¿ƒã«ç§»å‹•ã—ã¤ã¤ã€ãƒªã‚¹ãƒˆã‚‚ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    isMapFlying = true; 
                    map.flyTo([spot.lat, spot.lng], 13); 
                    showMapCard(spot.id); 
                });
                markers[spot.id] = marker;
            });
        }

        // ãƒ”ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«ã‚«ãƒ¼ãƒ‰ã¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        function showMapCard(id) {
            isProgrammaticScroll = true; // ç›£è¦–ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¸€æ™‚ç„¡åŠ¹åŒ–
            document.querySelectorAll('.pin-marker').forEach(el => el.classList.remove('active-pin'));
            const pin = document.getElementById(`pin-${id}`);
            if(pin) pin.classList.add('active-pin');

            const card = document.getElementById(`map-card-${id}`);
            if(card) {
                card.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                document.querySelectorAll('.map-card-horizontal').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
            }
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å®Œäº†äºˆæ¸¬æ™‚é–“å¾Œã«ãƒ•ãƒ©ã‚°è§£é™¤
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => { isProgrammaticScroll = false; }, 800);
        }

        // ã‚«ãƒ¼ãƒ‰ãŒç”»é¢ä¸­å¤®ã«æ¥ãŸæ™‚ã«ãƒãƒƒãƒ—ã‚’å‹•ã‹ã™å‡¦ç†
        function highlightMarker(id) {
            // ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            document.querySelectorAll('.pin-marker').forEach(el => el.classList.remove('active-pin'));
            const pin = document.getElementById(`pin-${id}`);
            if(pin) pin.classList.add('active-pin');

            // ã‚«ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            document.querySelectorAll('.map-card-horizontal').forEach(c => c.classList.remove('active'));
            const card = document.getElementById(`map-card-${id}`);
            if(card) card.classList.add('active');

            // ãƒãƒƒãƒ—ã‚’ä¸­å¿ƒã¸ï¼ˆã‚«ãƒ¼ãƒ‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹ç§»å‹•ãªã®ã§ãƒªã‚¹ãƒˆå†ç”Ÿæˆã¯ã—ãªã„ï¼‰
            const spot = facilitiesData.find(f => f.id === id);
            if(spot && map) {
                isMapFlying = true; // moveendã‚¤ãƒ™ãƒ³ãƒˆã§ã®ãƒªã‚¹ãƒˆå†ç”Ÿæˆã‚’é˜²æ­¢
                map.panTo([spot.lat, spot.lng], { animate: true, duration: 1.0 });
            }
        }

        function setupObserver() {
            if (observer) observer.disconnect();
            
            observer = new IntersectionObserver((entries) => {
                if (isProgrammaticScroll) return; // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã‚‹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä¸­ã¯ç„¡è¦–

                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = parseInt(entry.target.id.replace('map-card-', ''));
                        highlightMarker(id);
                    }
                });
            }, {
                root: document.getElementById('card-scroller'),
                threshold: 0.55 // ã‚«ãƒ¼ãƒ‰ãŒ55%è¦‹ãˆãŸã‚‰ç™ºç«ï¼ˆä¸­å¤®ã«æ¥ãŸæ™‚ï¼‰
            });

            document.querySelectorAll('.map-card-horizontal').forEach(card => observer.observe(card));
        }

        function updateVisibleSpots() {
            const center = map.getCenter();
            // ç¾åœ¨åœ°ãŒã‚ã‚Œã°ç¾åœ¨åœ°ã€ãªã‘ã‚Œã°ãƒãƒƒãƒ—ä¸­å¿ƒã‹ã‚‰ã®è·é›¢ã§ã‚½ãƒ¼ãƒˆ
            const refLat = userCurrentPos ? userCurrentPos.lat : center.lat;
            const refLng = userCurrentPos ? userCurrentPos.lng : center.lng;

            const sorted = facilitiesData.filter(f => f.lat && activeMapCategories.has(f.category))
                .map(f => ({ ...f, dist: getDistance(refLat, refLng, f.lat, f.lng) }))
                .sort((a, b) => a.dist - b.dist); // è¿‘ã„é †ã«ã‚½ãƒ¼ãƒˆï¼ˆã“ã‚ŒãŒUXã®æ­£è§£ï¼‰
                
            const scroller = document.getElementById('card-scroller');
            
            // HTMLç”Ÿæˆ
            scroller.innerHTML = sorted.map(spot => `
                <div id="map-card-${spot.id}" class="map-card-horizontal" onclick="isMapFlying=true; map.flyTo([${spot.lat}, ${spot.lng}], 14); showMapCard(${spot.id}); event.stopPropagation();">
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-slate-800 text-base line-clamp-1 underline decoration-dotted decoration-teal-500" onclick="window.open('https://www.google.com/search?q=${encodeURIComponent(spot.name)}', '_blank'); event.stopPropagation();">${spot.name}</h3>
                            <div class="text-xl">${getIcon(spot.category)}</div>
                        </div>
                        <p class="text-xs text-red-500 font-bold mb-1">${spot.price}</p>
                        <p class="text-[10px] text-slate-400"><i class="fas fa-map-marker-alt"></i> ${spot.dist < 1 ? Math.round(spot.dist*1000)+'m' : spot.dist.toFixed(1)+'km'}å…ˆ</p>
                    </div>
                    <div class="mt-2 pt-2 border-t border-slate-100 flex gap-2">
                        <button onclick="handleNav('${spot.name}', ${spot.lat}, ${spot.lng}); event.stopPropagation()" class="flex-1 bg-teal-600 text-white text-xs font-bold py-2 rounded-lg"><i class="fas fa-location-arrow"></i> ãƒŠãƒ“</button>
                    </div>
                </div>
            `).join('') + '<div style="flex:0 0 10px"></div>';

            // ãƒªã‚¹ãƒˆç”Ÿæˆå¾Œã«ç›£è¦–ã‚’é–‹å§‹
            setupObserver();
        }

        function renderList() {
            const container = document.getElementById('list-container');
            let targets = facilitiesData.filter(f => {
                if(activeListCategory !== 'all' && f.category !== activeListCategory) return false;
                if(searchQuery && !f.name.includes(searchQuery) && !f.pref.includes(searchQuery)) return false;
                return true;
            });
            if(userCurrentPos) targets.sort((a,b) => getDistance(userCurrentPos.lat,userCurrentPos.lng,a.lat,a.lng) - getDistance(userCurrentPos.lat,userCurrentPos.lng,b.lat,b.lng));
            
            if(targets.length === 0) { container.innerHTML = `<div class="text-center py-10 text-slate-400">è©²å½“ãªã—</div>`; return; }

            const grouped = {}; 
            targets.forEach(f => { if(!grouped[f.pref]) grouped[f.pref] = []; grouped[f.pref].push(f); });
            
            const prefOrder = ["åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ","èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ","æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ","å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ","æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ","é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ","å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ","ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ"];
            
            container.innerHTML = prefOrder.filter(p => grouped[p]).map(pref => `
                <details class="group mb-3 bg-white rounded-xl shadow-sm overflow-hidden">
                    <summary class="flex justify-between p-4 cursor-pointer bg-slate-50 font-bold text-teal-800">
                        <span>${pref} <span class="text-xs bg-teal-100 text-teal-600 px-2 rounded-full ml-2">${grouped[pref].length}</span></span>
                        <i class="fas fa-chevron-down text-slate-300 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-3 border-t grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${grouped[pref].map(spot => createCardHTML(spot)).join('')}
                    </div>
                </details>
            `).join('');
        }

        function createCardHTML(spot) {
            const isFav = userStatus[spot.id]?.fav;
            const url = spot.url || `https://www.google.com/search?q=${encodeURIComponent(spot.name)}`;
            return `
                <div class="map-card relative hover:shadow-md transition-shadow" onclick="window.open('${url}', '_blank')">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-[10px] bg-slate-100 px-2 py-1 rounded text-slate-500 font-bold">${spot.area}</span>
                        <div class="text-xl opacity-40">${getIcon(spot.category)}</div>
                    </div>
                    <h3 class="font-bold text-lg text-slate-800 mb-1 underline decoration-dotted decoration-teal-500">${spot.name}</h3>
                    <div class="inline-block bg-red-50 text-red-600 text-xs font-bold px-2 py-1 rounded mb-3">${spot.price}</div>
                    <div class="flex gap-2 mt-auto">
                        <button onclick="handleNav('${spot.name}', ${spot.lat}, ${spot.lng}); event.stopPropagation()" class="flex-1 bg-teal-600 text-white text-xs font-bold py-2 rounded-lg shadow-sm"><i class="fas fa-location-arrow mr-1"></i>ãƒŠãƒ“</button>
                        ${spot.lat ? `<button onclick="jumpToMap(${spot.lat}, ${spot.lng}, ${spot.id}); event.stopPropagation()" class="w-10 bg-white border border-slate-200 rounded-lg text-slate-400 hover:text-teal-600"><i class="fas fa-map-marker-alt"></i></button>` : ''}
                        <button onclick="toggleFav(${spot.id}); event.stopPropagation()" class="w-10 bg-white border border-${isFav?'pink-200':'slate-200'} rounded-lg text-${isFav?'pink-500':'slate-300'}"><i class="${isFav?'fas':'far'} fa-heart"></i></button>
                    </div>
                </div>
            `;
        }

        function handleNav(name, lat, lng) {
            window.tempNav = { name, lat, lng };
            document.getElementById('map-select-modal').classList.add('show');
        }
        function confirmNavigation(type) {
            const t = window.tempNav;
            if(type === 'google') window.open(`http://maps.google.com/maps?daddr=${t.lat},${t.lng}&q=${encodeURIComponent(t.name)}`);
            else window.open(`geo:${t.lat},${t.lng}?q=${encodeURIComponent(t.name)}`);
            closeModal('map-select-modal');
        }

        function locateUserOnMap() {
            if(!navigator.geolocation) return alert('ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“');
            navigator.geolocation.getCurrentPosition(pos => {
                userCurrentPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                isMapFlying = false; // å¼·åˆ¶çš„ã«å†æç”»ã•ã›ã‚‹
                map.flyTo([userCurrentPos.lat, userCurrentPos.lng], 13);
                L.marker([userCurrentPos.lat, userCurrentPos.lng], {
                    icon: L.divIcon({ html: '<div class="w-4 h-4 bg-teal-500 rounded-full border-2 border-white shadow-lg"></div>', className:'' })
                }).addTo(map);
                updateVisibleSpots();
            });
        }
        function toggleFav(id) {
            if(!userStatus[id]) userStatus[id] = {};
            userStatus[id].fav = !userStatus[id].fav;
            localStorage.setItem('handimap_v2', JSON.stringify(userStatus));
            renderList(); renderMyList();
        }
        function switchPage(p) {
            document.querySelectorAll('.page').forEach(e => e.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById('nav-'+p).classList.add('active');
            if(p === 'map') setTimeout(() => { map.invalidateSize(); isMapFlying=false; updateVisibleSpots(); }, 100);
        }
        function toggleMapFilter(cat, btn) {
            if(activeMapCategories.has(cat)) { activeMapCategories.delete(cat); btn.classList.remove('active'); }
            else { activeMapCategories.add(cat); btn.classList.add('active'); }
            renderAllMarkers(); updateVisibleSpots();
        }
        function applyListFilter(cat, btn) {
            activeListCategory = cat;
            document.querySelectorAll('#page-list .chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            renderList();
        }
        function handleSearch(val) { searchQuery = val; renderList(); }
        function renderMyList() {
            const list = facilitiesData.filter(f => userStatus[f.id]?.[currentListTab]);
            document.getElementById('mylist-container').innerHTML = list.length ? list.map(f => createCardHTML(f)).join('') : '<div class="text-center text-slate-400 mt-10">ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
        }
        function jumpToMap(lat, lng, id) { switchPage('map'); isMapFlying = true; map.flyTo([lat, lng], 14); showMapCard(id); }
        function switchListTab(t) { currentListTab = t; document.getElementById('tab-fav').className = t==='fav'?'px-3 py-1 text-xs font-bold rounded bg-white text-teal-600 shadow-sm':'px-3 py-1 text-xs font-bold rounded text-slate-400'; document.getElementById('tab-visited').className = t==='visited'?'px-3 py-1 text-xs font-bold rounded bg-white text-green-600 shadow-sm':'px-3 py-1 text-xs font-bold rounded text-slate-400'; renderMyList(); }
        
        // Admin Functions
        function checkAdminPasscode() {
            if(document.getElementById('admin-passcode').value === '19870429') {
                document.getElementById('passcode-area').style.display = 'none';
                document.getElementById('csv-admin-controls').classList.remove('hidden');
            } else alert('ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
        }
        function openBackupModal(t) { 
            document.getElementById('backup-modal').classList.add('show');
            const txt = document.getElementById('backup-text');
            const btn = document.getElementById('backup-action-btn');
            if(t === 'export') {
                document.getElementById('backup-title').innerText = "ãƒ‡ãƒ¼ã‚¿ä¿å­˜";
                txt.value = JSON.stringify(userStatus);
                btn.innerText = "ã‚³ãƒ”ãƒ¼";
                btn.onclick = () => { txt.select(); document.execCommand('copy'); alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'); };
            } else {
                document.getElementById('backup-title').innerText = "ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ";
                txt.value = "";
                btn.innerText = "å¾©å…ƒ";
                btn.onclick = () => {
                    try {
                        userStatus = JSON.parse(txt.value);
                        localStorage.setItem('handimap_v2', JSON.stringify(userStatus));
                        renderMyList(); renderList();
                        alert('å¾©å…ƒã—ã¾ã—ãŸ'); closeModal('backup-modal');
                    } catch(e) { alert('ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“'); }
                };
            }
        }
        function downloadCSV() {
            const rows = [["ID", "æ–½è¨­å", "éƒ½é“åºœçœŒ", "ã‚¨ãƒªã‚¢", "ã‚¸ãƒ£ãƒ³ãƒ«", "æ–™é‡‘", "ä½æ‰€", "URL", "ç·¯åº¦", "çµŒåº¦", "è¡ŒããŸã„", "è¡Œã£ãŸ"]];
            facilitiesData.forEach(f => {
                const s = userStatus[f.id] || {};
                rows.push([f.id, f.name, f.pref, f.area, f.category, f.price, f.address, f.url, f.lat, f.lng, s.fav?"1":"0", s.visited?"1":"0"]);
            });
            const csvContent = "\uFEFF" + rows.map(r => r.map(c => `"${c}"`).join(",")).join("\n");
            const link = document.createElement("a"); link.href = URL.createObjectURL(new Blob([csvContent], { type: "text/csv;charset=utf-8;" }));
            link.download = `handimap_data_${new Date().toISOString().slice(0,10)}.csv`; link.click();
        }
        function handleCSVUpload(input) {
            const file = input.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const lines = e.target.result.split(/\r\n|\n/); let count = 0;
                    for(let i=1; i<lines.length; i++) {
                        const cols = lines[i].split(",").map(c => c.trim().replace(/^"|"$/g, ''));
                        if(cols.length < 12) continue;
                        const id = parseInt(cols[0]);
                        if(id) {
                            if(!userStatus[id]) userStatus[id] = {};
                            userStatus[id].fav = cols[10] === "1"; userStatus[id].visited = cols[11] === "1";
                            count++;
                        }
                    }
                    localStorage.setItem('handimap_v2', JSON.stringify(userStatus));
                    renderMyList(); renderList(); alert(`${count}ä»¶æ›´æ–°ã—ã¾ã—ãŸ`);
                } catch(err) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"); }
                input.value = "";
            };
            reader.readAsText(file);
        }

        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
    </script>
</body>
</html>
