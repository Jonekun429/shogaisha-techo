<!DOCTYPE html>

<html lang="ja">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

    <title>HandiMap Kanto</title>

    

    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">

    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/854/854878.png">



    <meta name="apple-mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="apple-mobile-web-app-title" content="HandiMap">

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://cdn.tailwindcss.com"></script>

    <script>

        tailwind.config = {

            theme: {

                extend: {

                    fontFamily: { sans: ['"M PLUS Rounded 1c"', 'sans-serif'] },

                    colors: { primary: '#0D9488', secondary: '#F0FDFA' },

                    animation: { 'bounce-slow': 'bounce 3s infinite' }

                }

            }

        }

    </script>

    <style>

        /* 基本設定 */

        html, body { 

            height: 100%; width: 100%; overflow: hidden; 

            overscroll-behavior: none; background-color: #F8FAFC; 

            -webkit-font-smoothing: antialiased; color: #334155; 

            padding: 0; margin: 0;

        }



        /* アプリ全体のコンテナ */

        #app-container { 

            display: flex; flex-direction: column; 

            height: 100dvh; width: 100vw; position: relative;

        }

        @media (min-width: 768px) { #app-container { flex-direction: row; } }



        /* 各ページの設定 - ナビゲーションバーの分だけ下部を空ける */

        .page { 

            display: none; 

            flex: 1; 

            height: 100%; 

            width: 100%; 

            flex-direction: column; 

            position: relative; 

            overflow: hidden; 

        }

        .page.active { display: flex; }

        

        /* Map & Pins */

        #map { flex: 1; width: 100%; z-index: 0; background: #e5e7eb; }

        .pin-marker { background: white; border-radius: 50%; border: 2.5px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; font-size: 24px; width: 44px; height: 44px; position: relative; transition: all 0.3s; }

        .pin-marker::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid white; }

        .pin-marker.active-pin { background: #0D9488; color: white; border-color: #0D9488; transform: scale(1.3) translateY(-10px); z-index: 9999 !important; }

        .pin-marker.active-pin::after { border-top-color: #0D9488; }



        /* Filter */

        .filter-bar { 

            position: absolute; top: 0; left: 0; right: 0; z-index: 500; display: flex; justify-content: center; pointer-events: none; 

            /* 修正: 上部の余白を確実に確保 */

            padding-top: calc(12px + env(safe-area-inset-top)); 

        }

        .chip-scroll { display: flex; gap: 8px; overflow-x: auto; padding: 6px 16px; scrollbar-width: none; pointer-events: auto; max-width: 95%; background: rgba(255,255,255,0.9); backdrop-filter: blur(8px); border-radius: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }

        .chip { padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; white-space: nowrap; background: #F1F5F9; color: #94A3B8; transition: all 0.2s; }

        .chip.active { background: #0D9488; color: white; }



        /* Cards Scroller Area */

        .sheet-wrapper {

            /* ナビゲーションバー(約80px)の上に来るように配置 */

            position: absolute; 

            bottom: calc(70px + env(safe-area-inset-bottom)); 

            left: 0; right: 0; pointer-events: none; z-index: 400;

        }

        @media (min-width: 768px) { .sheet-wrapper { bottom: 20px; } }



        .card-scroller { 

            display: flex; gap: 12px; padding: 0 16px 10px; 

            overflow-x: auto; scroll-snap-type: x mandatory; height: 180px; 

            pointer-events: auto; 

        }

        

        .map-card-horizontal { 

            flex: 0 0 85%; max-width: 340px; scroll-snap-align: center; 

            background: white; border-radius: 20px; padding: 16px; 

            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 3px solid transparent; 

            transition: all 0.3s; display: flex; flex-direction: column; 

            opacity: 0.8; transform: scale(0.95); 

        }

        .map-card-horizontal.active { 

            border-color: #0D9488; opacity: 1; transform: scale(1); 

            box-shadow: 0 15px 40px rgba(13, 148, 136, 0.2);

        }



        .map-card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 12px; border: 1px solid #F1F5F9; cursor: pointer; transition: background-color 0.2s; }

        .map-card:active { background-color: #F0FDFA; }



        /* UI Components */

        .gps-btn { 

            width: 44px; height: 44px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.15); color: #0D9488; font-size: 18px; position: absolute; right: 16px; 

            /* カード位置 + 余白 */

            bottom: calc(260px + env(safe-area-inset-bottom)); z-index: 500; 

        }



        /* Nav - 修正: position: fixed で画面最下部に強制固定 */

        .nav-container { 

            position: fixed;

            bottom: 0;

            left: 0;

            right: 0;

            z-index: 3000; 

            background: white; 

            border-top: 1px solid #eee; 

            display: flex; 

            justify-content: space-around; 

            /* 下部のセーフエリア（ホームバー）分の余白を確保 */

            padding-bottom: env(safe-area-inset-bottom);

            /* 高さ = コンテンツ60px + セーフエリア */

            height: calc(60px + env(safe-area-inset-bottom)); 

            width: 100%; 

        }

        @media (min-width: 768px) { 

            .nav-container { position: static; width: 240px; height: 100%; flex-direction: column; justify-content: flex-start; padding-top: 40px; border-right: 1px solid #eee; border-top: none; padding-bottom: 0; } 

        }

        

        /* Navアイテムの高さ調整 */

        .nav-item { 

            flex: 1; 

            display: flex; 

            flex-direction: column; 

            align-items: center; 

            justify-content: center; /* 60pxの中で中央揃え */

            color: #94A3B8; 

            font-size: 10px; 

            font-weight: bold; 

            cursor: pointer; 

            height: 60px; /* 固定高さ */

        }

        @media (min-width: 768px) { .nav-item { flex: 0; flex-direction: row; gap: 12px; padding: 16px; font-size: 14px; height: auto; } }

        .nav-item.active { color: #0D9488; }

        

        .modal-overlay { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(0,0,0,0.4); backdrop-filter: blur(2px); align-items: center; justify-content: center; }

        .modal-overlay.show { display: flex; }

        .modal-box { background: white; width: 85%; max-width: 320px; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }

        

        details > summary { list-style: none; }

        details > summary::-webkit-details-marker { display: none; }

        

        /* 修正: リストヘッダーの上部余白を計算式で確保（ステータスバー回避） */

        .list-header-padding { 

            padding-top: calc(16px + env(safe-area-inset-top)); 

        }

        

        /* リストコンテナの下部余白（ナビゲーションバーに隠れないように） */

        .list-container-padding {

            padding-bottom: calc(90px + env(safe-area-inset-bottom));

        }

    </style>

</head>

<body class="text-slate-700">



    <div id="app-container">

        <main class="flex-1 relative order-1 md:order-2 overflow-hidden bg-slate-50 w-full h-full">

            <div id="page-map" class="page active">

                <div class="filter-bar">

                    <div class="chip-scroll">

                        <button class="chip active" onclick="toggleMapFilter('leisure', this)">遊園地</button>

                        <button class="chip active" onclick="toggleMapFilter('aquarium', this)">水族館</button>

                        <button class="chip active" onclick="toggleMapFilter('zoo', this)">動物園</button>

                        <button class="chip active" onclick="toggleMapFilter('museum', this)">博物館</button>

                        <button class="chip active" onclick="toggleMapFilter('park', this)">公園</button>

                        <button class="chip active" onclick="toggleMapFilter('cinema', this)">映画</button>

                    </div>

                </div>

                <button onclick="locateUserOnMap()" class="gps-btn"><i class="fas fa-crosshairs"></i></button>

                <div id="map"></div>

                <div class="sheet-wrapper">

                    <div id="card-scroller" class="card-scroller"></div>

                </div>

            </div>



            <div id="page-list" class="page overflow-y-auto">

                <div class="bg-white/90 backdrop-blur border-b border-slate-200 p-4 sticky top-0 z-10 list-header-padding">

                    <div class="relative w-full mb-3">

                        <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>

                        <input type="text" class="w-full bg-slate-100 rounded-xl py-2.5 pl-10 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="エリア、ジャンル、施設名で検索..." oninput="handleSearch(this.value)">

                    </div>

                    <div class="chip-scroll">

                        <button class="chip active" onclick="applyListFilter('all', this)">すべて</button>

                        <button class="chip" onclick="applyListFilter('leisure', this)">遊園地</button>

                        <button class="chip" onclick="applyListFilter('aquarium', this)">水族館</button>

                        <button class="chip" onclick="applyListFilter('zoo', this)">動物園</button>

                        <button class="chip" onclick="applyListFilter('museum', this)">博物館</button>

                    </div>

                </div>

                <div id="list-container" class="p-4 max-w-3xl mx-auto w-full list-container-padding"></div>

            </div>



            <div id="page-mylist" class="page overflow-y-auto">

                 <div class="sticky top-0 z-20 bg-white/95 backdrop-blur border-b border-slate-100 px-6 py-4 flex justify-between items-center list-header-padding">

                    <h1 class="text-lg font-bold"><i class="fas fa-bookmark text-pink-500 mr-2"></i>保存済み</h1>

                    <div class="flex bg-slate-100 rounded-lg p-1 gap-1">

                        <button onclick="switchListTab('fav')" id="tab-fav" class="px-3 py-1 text-xs font-bold rounded bg-white text-teal-600 shadow-sm">行きたい</button>

                        <button onclick="switchListTab('visited')" id="tab-visited" class="px-3 py-1 text-xs font-bold rounded text-slate-400">行った</button>

                    </div>

                </div>

                <div id="mylist-container" class="p-4 max-w-3xl mx-auto w-full"></div>

                

                <div class="p-6 border-t mt-auto text-center bg-white list-container-padding">

                    <h3 class="text-xs font-bold text-slate-400 mb-3">設定・データ管理</h3>

                    <div class="flex gap-3 justify-center mb-4">

                        <button onclick="openBackupModal('export')" class="px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg text-xs font-bold text-slate-600 shadow-sm"><i class="fas fa-copy mr-1"></i>データ保存</button>

                        <button onclick="openBackupModal('import')" class="px-4 py-2 bg-slate-100 border border-slate-200 rounded-lg text-xs font-bold text-slate-600 shadow-sm"><i class="fas fa-paste mr-1"></i>データ復元</button>

                    </div>

                    

                    <div class="border-t border-slate-100 pt-4">

                        <div id="passcode-area" class="flex flex-col items-center gap-2">

                            <p class="text-[10px] text-slate-300">管理者用</p>

                            <div class="flex gap-2">

                                <input type="password" id="admin-passcode" placeholder="PASS" class="border border-slate-200 rounded px-2 py-1 text-xs w-20 text-center">

                                <button onclick="checkAdminPasscode()" class="bg-slate-300 text-white text-[10px] px-2 py-1 rounded font-bold">OK</button>

                            </div>

                        </div>

                        <div id="csv-admin-controls" class="hidden mt-2 animate-pulse bg-teal-50 border border-teal-200 rounded-xl p-3">

                            <p class="text-[10px] font-bold text-teal-700 mb-2">管理者モード</p>

                            <div class="flex gap-2 justify-center">

                                <button onclick="downloadCSV()" class="px-3 py-2 bg-teal-600 text-white rounded text-xs font-bold flex-1">CSV保存</button>

                                <label class="px-3 py-2 bg-white border border-teal-600 text-teal-600 rounded text-xs font-bold flex-1 cursor-pointer flex items-center justify-center">

                                    CSV読込

                                    <input type="file" id="csv-upload-input" accept=".csv" class="hidden" onchange="handleCSVUpload(this)">

                                </label>

                            </div>

                        </div>

                    </div>

                </div>

            </div>

        </main>



        <nav class="nav-container order-2 md:order-1">

            <div class="hidden md:block px-6 mb-8 text-teal-800 font-extrabold text-xl"><i class="fas fa-universal-access mr-2"></i>HandiMap</div>

            <div class="nav-item active" onclick="switchPage('map')" id="nav-map"><i class="fas fa-map-marked-alt text-xl md:text-base"></i><span>マップ</span></div>

            <div class="nav-item" onclick="switchPage('list')" id="nav-list"><i class="fas fa-search text-xl md:text-base"></i><span>探す</span></div>

            <div class="nav-item" onclick="switchPage('mylist')" id="nav-mylist"><i class="fas fa-heart text-xl md:text-base"></i><span>保存済み</span></div>

        </nav>

    </div>



    <div id="map-select-modal" class="modal-overlay">

        <div class="modal-box text-left">

            <h3 class="text-lg font-bold mb-4 text-center">経路案内</h3>

            <div class="flex flex-col gap-3 mb-4">

                <button onclick="confirmNavigation('google')" class="p-3 rounded-xl border hover:bg-teal-50 font-bold text-sm flex items-center"><i class="fab fa-google text-red-500 mr-3"></i>Googleマップ</button>

                <button onclick="confirmNavigation('default')" class="p-3 rounded-xl border hover:bg-teal-50 font-bold text-sm flex items-center"><i class="fas fa-map-marker-alt text-slate-500 mr-3"></i>標準マップ</button>

            </div>

            <button onclick="closeModal('map-select-modal')" class="text-sm text-slate-400 w-full py-2">キャンセル</button>

        </div>

    </div>



    <div id="backup-modal" class="modal-overlay">

        <div class="modal-box">

            <h3 id="backup-title" class="font-bold mb-2">データ管理</h3>

            <p class="text-[10px] text-slate-400 mb-2">以下のコードをコピー/ペーストしてください</p>

            <textarea id="backup-text" class="w-full h-24 p-2 bg-slate-100 rounded text-xs mb-3 font-mono"></textarea>

            <div class="flex gap-2 justify-center">

                <button id="backup-action-btn" class="bg-teal-600 text-white px-4 py-2 rounded-lg text-xs font-bold">実行</button>

            </div>

            <button onclick="closeModal('backup-modal')" class="mt-3 text-xs text-slate-400">閉じる</button>

        </div>

    </div>



    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>

        const MASTER_CSV = `ID,施設名,都道府県,エリア,ジャンル,料金,住所,URL,緯度,経度

1001,旭川市旭山動物園,北海道,旭川市,zoo,本人と介護者1名無料,北海道旭川市東旭川町倉沼,,43.7684,142.48

1002,札幌市円山動物園,北海道,札幌市,zoo,本人と介護者1名無料,北海道札幌市中央区宮ヶ丘3番地1,,43.0526,141.3082

1003,北海道開拓の村,北海道,札幌市,museum,本人と介護者1名無料,北海道札幌市厚別区厚別町小野幌50-1,,43.0493,141.4983

1004,三内丸山遺跡センター,青森県,青森市,museum,本人と付添人1名無料,青森県青森市三内字丸山305,,40.8122,140.697

1005,盛岡市動物公園 ZOOMA,岩手県,盛岡市,park,本人と介護者1名無料,岩手県盛岡市新庄字下八木田60-18,,39.7214,141.1923

1006,仙台市博物館,宮城県,仙台市,museum,本人と介護者1名無料,宮城県仙台市青葉区川内26,,38.2562,140.8566

1007,アクアマリンふくしま,福島県,いわき市,aquarium,本人と介護者1名無料,福島県いわき市小名浜字辰巳町50,,36.9427,140.9032

1008,鶴ヶ城（会津若松城）,福島県,会津若松市,museum,本人と付添人1名無料,福島県会津若松市追手町1-1,,37.4875,139.9297

1009,国営ひたち海浜公園,茨城県,ひたちなか市,park,本人と付添人1名無料,茨城県ひたちなか市馬渡字大沼605-4,,36.4027,140.5927

1010,日光田母沢御用邸記念公園,栃木県,日光市,park,本人と付添人1名無料,栃木県日光市本町8-27,,36.7533,139.5936

1011,富岡製糸場,群馬県,富岡市,museum,本人と介護者1名無料,群馬県富岡市富岡1-1,,36.2553,138.8925

1012,群馬県立自然史博物館,群馬県,富岡市,museum,本人と介護者1名無料,群馬県富岡市上黒岩1674-1,,36.2647,138.8833

1013,さいたま水族館,埼玉県,羽生市,aquarium,本人と介護者1名無料,埼玉県羽生市三田ヶ谷751-1,,36.1736,139.5925

1014,千葉市動物公園,千葉県,千葉市,park,本人と介護者1名無料,千葉県千葉市若葉区源町280,,35.6369,140.1222

1015,東京国立博物館,東京都,台東区,museum,本人と介護者1名無料（総合文化展）,東京都台東区上野公園13-9,,35.7187,139.7765

1016,国立科学博物館,東京都,台東区,museum,本人と介護者1名無料,東京都台東区上野公園7-20,,35.7163,139.7766

1017,恩賜上野動物園,東京都,台東区,zoo,本人と付添人1名無料,東京都台東区上野公園9-83,,35.7165,139.7713

1018,新宿御苑,東京都,新宿区,museum,本人と介助者1名無料,東京都新宿区内藤町11,,35.6851,139.71

1019,葛西臨海水族園,東京都,江戸川区,museum,本人と付添人1名無料,東京都江戸川区臨海町6-2-3,,35.6401,139.8624

1020,よこはま動物園ズーラシア,神奈川県,横浜市,zoo,本人と介護者2名まで無料,神奈川県横浜市旭区上白根町1175-1,,35.4944,139.5255

1021,川崎市藤子・F・不二雄ミュージアム,神奈川県,川崎市,leisure,本人と介助者1名無料（要予約）,神奈川県川崎市多摩区長尾2-8-1,,35.6103,139.5732

1022,新潟市水族館 マリンピア日本海,新潟県,新潟市,aquarium,本人と介助者1名無料,新潟県新潟市中央区西船見町5932-445,,37.9239,139.0322

1023,兼六園,石川県,金沢市,park,本人と介護者1名無料,石川県金沢市兼六町1,,36.562,136.6625

1024,福井県立恐竜博物館,福井県,勝山市,museum,本人と介護者1名無料（常設展）,福井県勝山市村岡町寺尾51-11,,36.0545,136.5033

1025,山梨県立リニア見学センター,山梨県,都留市,museum,本人と介助者1名無料,山梨県都留市小形山2381,,35.567,138.9372

1026,国宝 松本城,長野県,松本市,museum,本人と介助者1名無料,長野県松本市丸の内4-1,,36.2387,137.9691

1027,岐阜城,岐阜県,岐阜市,museum,本人と介護者1名無料,岐阜県岐阜市金華山天守閣18,,35.4339,136.7821

1028,浜松市動物園,静岡県,浜松市,zoo,本人と介護者1名無料,静岡県浜松市西区舘山寺町199,,34.7644,137.6622

1029,名古屋城,愛知県,名古屋市,museum,本人と介護者2名まで無料,愛知県名古屋市中区本丸1-1,,35.1847,136.9

1030,東山動植物園,愛知県,名古屋市,museum,本人と介護者2名まで無料,愛知県名古屋市千種区東山元町3-70,,35.1565,136.9744

1031,トヨタ産業技術記念館,愛知県,名古屋市,museum,本人と付添人1名無料,愛知県名古屋市西区則武新町4-1-35,,35.1828,136.8753

1032,彦根城,滋賀県,彦根市,museum,本人と付添人1名無料,滋賀県彦根市金亀町1-1,,35.2766,136.2517

1033,元離宮二条城,京都府,京都市,museum,本人と介護者1名無料,京都府京都市中京区二条通堀川西入二条城町541,,35.0142,135.7482

1034,京都国立博物館,京都府,京都市,museum,本人と介護者1名無料（名品ギャラリー）,京都府京都市東山区茶屋町527,,34.9906,135.7725

1035,京都市動物園,京都府,京都市,zoo,本人と介護者1名無料,京都府京都市左京区岡崎法勝寺町岡崎公園内,,35.0116,135.7836

1036,大阪城天守閣,大阪府,大阪市,museum,本人と介護者1名無料,大阪府大阪市中央区大阪城1-1,,34.6873,135.5262

1037,天王寺動物園,大阪府,大阪市,zoo,本人と付添人1名無料,大阪府大阪市天王寺区茶臼山町1-108,,34.6506,135.5103

1038,万博記念公園,大阪府,吹田市,park,本人と介助者1名無料,大阪府吹田市千里万博公園,,34.8028,135.5367

1039,姫路城,兵庫県,姫路市,museum,本人と介助者1名無料,兵庫県姫路市本町68,,34.8394,134.6939

1040,神戸市立王子動物園,兵庫県,神戸市,zoo,本人と介護者1名無料,兵庫県神戸市灘区王子町3-1,,34.7126,135.2166

1041,奈良国立博物館,奈良県,奈良市,museum,本人と介護者1名無料,奈良県奈良市登大路町50,,34.6836,135.8358

1042,和歌山城,和歌山県,和歌山市,museum,本人と付添人1名無料,和歌山県和歌山市一番丁3,,34.2255,135.1706

1043,鳥取砂丘 砂の美術館,鳥取県,鳥取市,museum,本人と介護者1名無料,鳥取県鳥取市福部町湯山2083-17,,35.5404,134.2382

1044,松江城,島根県,松江市,museum,本人と介助者1名無料,島根県松江市殿町1-5,,35.4753,133.0505

1045,岡山後楽園,岡山県,岡山市,park,本人と介護者1名無料,岡山県岡山市北区後楽園1-5,,34.6669,133.9358

1046,広島平和記念資料館,広島県,広島市,museum,本人と介護者1名無料,広島県広島市中区中島町1-2,,34.3916,132.4519

1047,海響館（市立しものせき水族館）,山口県,下関市,aquarium,本人と介護者1名無料,山口県下関市あるかぽーと6-1,,33.9538,130.9436

1048,栗林公園,香川県,高松市,park,本人と介護者1名無料,香川県高松市栗林町1-20-16,,34.3323,134.0439

1049,松山城,愛媛県,松山市,museum,本人と介助者2名まで無料,愛媛県松山市丸之内1,,33.8455,132.7663

1050,愛媛県立とべ動物園,愛媛県,砥部町,zoo,本人と介護者1名無料,愛媛県伊予郡砥部町上原町240,,33.7667,132.7961

1051,高知城,高知県,高知市,museum,本人と介護者1名無料,高知県高知市丸ノ内1-2-1,,33.5607,133.5312

1052,九州国立博物館,福岡県,太宰府市,museum,本人と介護者1名無料（文化交流展）,福岡県太宰府市石坂4-7-2,,33.5186,130.5242

1053,海の中道海浜公園,福岡県,福岡市,park,本人と付添人1名無料,福岡県福岡市東区大字西戸崎18-25,,33.6558,130.3664

1054,グラバー園,長崎県,長崎市,park,本人と介護者1名無料,長崎県長崎市南山手町8-1,,32.7341,129.8696

1055,熊本城,熊本県,熊本市,museum,本人と付添人1名無料,熊本県熊本市中央区本丸1-1,,32.8062,130.7058

1056,フェニックス自然動物園,宮崎県,宮崎市,zoo,本人と介護者1名無料,宮崎県宮崎市塩路浜山3083-42,,31.9567,131.4722

1057,いおワールドかごしま水族館,鹿児島県,鹿児島市,aquarium,本人と介護者1名無料,鹿児島県鹿児島市本港新町3-1,,31.5947,130.5636

1058,沖縄美ら海水族館,沖縄県,本部町,aquarium,本人と付添人1名無料,沖縄県国頭郡本部町石川424,,26.6943,127.8779

1059,首里城公園,沖縄県,那覇市,museum,本人と介助者1名無料,沖縄県那覇市首里金城町1-2,,26.217,127.7196

1060,北海道博物館,北海道,札幌市,museum,本人と介護者1名無料,北海道札幌市厚別区厚別町小野幌53-2,https://www.hm.pref.hokkaido.lg.jp/,43.0531,141.4965

1061,北海道立近代美術館,北海道,札幌市,museum,本人と介護者1名無料,北海道札幌市中央区北1条西17丁目,https://artmuseum.pref.hokkaido.lg.jp/knb,43.0602,141.3303

1062,本郷新記念札幌彫刻美術館,北海道,札幌市,museum,本人と介護者1名無料,北海道札幌市中央区宮の森4条12丁目,http://www.hongoshin-smos.jp/,43.0548,141.2928

1063,札幌芸術の森,北海道,札幌市,museum,本人と介護者1名無料,北海道札幌市南区芸術の森2丁目75,https://artpark.or.jp/,42.9421,141.3422

1064,さっぽろ羊ケ丘展望台,北海道,札幌市,park,本人のみ無料,北海道札幌市豊平区羊ヶ丘1番地,https://www.hitsujigaoka.jp/,42.9991,141.3944

1065,AOAO SAPPORO,北海道,札幌市,aquarium,本人と介護者1名半額,北海道札幌市中央区南2条西3丁目20 moyuk SAPPORO 4F-6F,https://aoao-sapporo.blue/,43.0577,141.3533

1066,東京ディズニーリゾート,千葉県,浦安市,leisure,障がいのある方向けチケットあり（変動価格）,千葉県浦安市舞浜1-1,,35.6329,139.8804

1067,マザー牧場,千葉県,富津市,park,本人・介助者1名まで一般料金の半額,千葉県富津市田倉940-3,,35.246,139.9348

1068,鴨川シーワールド,千葉県,鴨川市,aquarium,本人・介助者1名まで一般料金の半額,千葉県鴨川市東町1464-18,,35.1164,140.1202

1069,市原ぞうの国,千葉県,市原市,zoo,本人・介助者1名まで約半額,千葉県市原市山小川937,,35.3547,140.1823

1070,東京ドイツ村,千葉県,袖ケ浦市,park,駐車料金等の割引（要確認）,千葉県袖ケ浦市永吉419,,35.4055,140.0594

1071,成田ゆめ牧場,千葉県,成田市,park,入場料割引（約半額）,千葉県成田市名木730-3,,35.8693,140.3954

1072,ふなばしアンデルセン公園,千葉県,船橋市,park,本人・介助者1名まで入園無料,千葉県船橋市金堀町525,,35.7599,140.0629

1073,千葉ポートタワー,千葉県,千葉市,leisure,本人・介助者1名まで入館無料,千葉県千葉市中央区中央港1,,35.6004,140.0978

1074,鋸山ロープウェー,千葉県,富津市,leisure,本人・介助者1名まで往復運賃約半額,千葉県富津市金谷4052-1,,35.1623,139.823

1075,京成バラ園,千葉県,八千代市,park,入園料割引,千葉県八千代市大和田新田755,,35.731,140.0875

1076,横浜・八景島シーパラダイス,神奈川県,横浜市,aquarium,ワンデーパス等が5割引き,神奈川県横浜市金沢区八景島,,35.3367,139.6468

1077,新江ノ島水族館,神奈川県,藤沢市,aquarium,本人・介助者1名まで一般料金の半額,神奈川県藤沢市片瀬海岸2-19-1,,35.3097,139.4797

1078,横浜ランドマークタワー スカイガーデン,神奈川県,横浜市,leisure,本人・介助者1名まで入場料半額,神奈川県横浜市西区みなとみらい2-2-1,,35.4543,139.631

1079,カップヌードルミュージアム 横浜,神奈川県,横浜市,museum,本人・介助者1名まで入館無料（体験料別途）,神奈川県横浜市中区新港2-3-4,,35.4554,139.6395

1080,箱根園水族館,神奈川県,箱根町,aquarium,本人・介助者1名まで割引（約半額）,神奈川県足柄下郡箱根町元箱根139,,35.2122,139.0093

1081,彫刻の森美術館,神奈川県,箱根町,museum,本人・介助者1名まで割引,神奈川県足柄下郡箱根町二ノ平1121,,35.2447,139.0513

1082,箱根ガラスの森美術館,神奈川県,箱根町,museum,本人・介助者1名まで割引,神奈川県足柄下郡箱根町仙石原940-48,,35.2663,139.0177

1083,よみうりランド,東京都,稲城市,leisure,ワンデーパス等割引,東京都稲城市矢野口4015-1,,35.623,139.5187

1084,箱根ロープウェイ,神奈川県,箱根町,leisure,運賃割引,神奈川県足柄下郡箱根町強羅1300,,35.2464,139.0356

1085,箱根海賊船,神奈川県,箱根町,leisure,運賃割引,神奈川県足柄下郡箱根町元箱根,,35.2009,139.0305

1086,マリーンルージュ,神奈川県,横浜市,leisure,乗船料割引,神奈川県横浜市中区山下町,,35.4456,139.6515

1087,TOHOシネマズ,東京都,千代田区,cinema,本人・介助者1名まで鑑賞料金1000円,東京都千代田区有楽町1-1-2,,35.6736,139.7592

1088,イオンシネマ,千葉県,千葉市,cinema,本人・介助者1名まで鑑賞料金1000円,千葉県千葉市美浜区豊砂1-1,,35.6512,140.0383

1089,109シネマズ,東京都,世田谷区,cinema,本人・介助者1名まで鑑賞料金1000円,東京都世田谷区玉川1-14-1,,35.611,139.6297

1090,ビッグエコー,東京都,中央区,leisure,室料割引（店舗により異なる）,東京都中央区銀座4-2-14,,35.6725,139.7635

1091,ラウンドワン,東京都,江東区,leisure,クラブ会員入会費免除・貸靴無料など店舗による,東京都江東区青海1-1-10,,35.6256,139.7745

1092,東京スカイツリー,東京都,墨田区,leisure,本人・介助者1名まで当日券が約半額,東京都墨田区押上1-1-2,,35.71,139.8107

1093,東京タワー,東京都,港区,leisure,本人・介助者1名まで約半額,東京都港区芝公園4-2-8,,35.6586,139.7454

1094,サンリオピューロランド,東京都,多摩市,leisure,本人・介助者1名までチケット200円引（窓口購入）,東京都多摩市落合1-31,,35.6246,139.4291

1095,サンシャイン水族館,東京都,豊島区,aquarium,本人・介助者1名まで約半額,東京都豊島区東池袋3-1,,35.7291,139.7198

1096,マクセル アクアパーク品川,東京都,港区,aquarium,本人・介助者1名まで約半額,東京都港区高輪4-10-30,,35.6278,139.7352

1097,すみだ水族館,東京都,墨田区,aquarium,本人・介助者1名まで約半額,東京都墨田区押上1-1-2,,35.71,139.8107

1098,しながわ水族館,東京都,品川区,aquarium,本人・介助者1名まで2割〜5割引（区外・区民で変動）,東京都品川区勝島3-2-1,,35.5884,139.7375

1099,東京ジョイポリス,東京都,港区,leisure,本人・介助者1名まで入場無料（パスポートは割引販売）,東京都港区台場1-6-1,,35.6288,139.7766

1100,六本木ヒルズ展望台 東京シティビュー,東京都,港区,leisure,本人・介助者1名まで約半額,東京都港区六本木6-10-1,,35.6604,139.7292

1101,浅草花やしき,東京都,台東区,leisure,本人・介助者1名まで入園無料（のりもの券別途）,東京都台東区浅草2-28-1,,35.7154,139.7946

1102,チームラボプラネッツ TOKYO DMM,東京都,江東区,museum,障がい者割引チケットあり（約半額〜）,東京都江東区豊洲6-1-16,,35.6469,139.7942

1103,レゴランド・ディスカバリー・センター東京,東京都,港区,park,障がい者割引チケットあり,東京都港区台場1-6-1,,35.6289,139.7763

1104,スモールワールズ,東京都,江東区,museum,本人・介助者1名まで割引,東京都江東区有明1-3-33,,35.6378,139.7883

1105,アートアクアリウム美術館 GINZA,東京都,中央区,museum,本人・介助者1名まで割引,東京都中央区銀座4-6-16,,35.6713,139.7661`;



        let map, markers = {};

        let userStatus = JSON.parse(localStorage.getItem('handimap_v2')) || {};

        let userCurrentPos = null;

        let activeListCategory = 'all';

        let activeMapCategories = new Set(['leisure', 'aquarium', 'zoo', 'museum', 'park', 'cinema']);

        let searchQuery = "";

        let currentListTab = 'fav';

        let facilitiesData = [];

        let isProgrammaticScroll = false;

        let scrollTimeout;

        let isMapFlying = false;

        let observer;



        window.onload = function() {

            facilitiesData = parseCSV(MASTER_CSV);

            initMap();

            renderList();

            renderMyList();

        };



        function parseCSV(csv) {

            return csv.trim().split('\n').slice(1).map(line => {

                const [id,name,pref,area,cat,price,addr,url,lat,lng] = line.split(',');

                if(!name) return null;

                return { 

                    id: parseInt(id), name, pref, area, category: cat, price, address: addr, url, 
